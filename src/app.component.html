<div class="min-h-screen bg-[#050505] text-gray-300 relative overflow-hidden font-sans selection:bg-rose-900 selection:text-rose-100">
  
  <!-- Global Scanline Overlay -->
  <div class="fixed inset-0 pointer-events-none z-0 opacity-10" 
       style="background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%;">
  </div>
  
  <!-- Vignette -->
  <div class="fixed inset-0 pointer-events-none z-0 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"></div>

  <!-- Header -->
  <header class="absolute top-0 left-0 w-full p-6 z-30 flex justify-between items-start">
    <div class="flex flex-col cursor-pointer group" (click)="toggleLore()">
      <span class="text-[10px] font-mono font-bold tracking-[0.2em] text-rose-600 uppercase leading-none hover:text-rose-400 transition-colors">
        Postcards To Mars
      </span>
      <span class="text-[8px] font-mono text-gray-400 leading-none mt-1 tracking-wider group-hover:text-gray-300">
        {{ showLore() ? 'TERMINATE SESSION' : 'SYSTEM STATUS: DEGRADED' }}
      </span>
    </div>
    
    <div class="flex items-center gap-6">
      <button (click)="toggleAbout()" class="text-[10px] font-mono text-gray-500 hover:text-white uppercase tracking-widest transition-colors">
        [ INFO ]
      </button>
      <button (click)="reset()" class="text-[10px] font-mono text-gray-500 hover:text-rose-500 uppercase tracking-widest transition-colors">
        [ RESET UPLINK ]
      </button>
    </div>
  </header>

  <!-- Info Modal (Unified Terminal Style - Zinc Variant) -->
  @if (showAbout()) {
    <div class="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in font-mono" (click)="toggleAbout()">
       <div class="max-w-md w-full border-2 border-zinc-800 bg-[#050505] p-1 relative shadow-[0_0_40px_rgba(255,255,255,0.05)]" (click)="$event.stopPropagation()">
          
          <!-- Inner CRT Frame -->
          <div class="border border-zinc-800/50 bg-zinc-900/5 p-8 relative overflow-hidden">
              
              <!-- Scanlines -->
              <div class="absolute inset-0 pointer-events-none opacity-10" style="background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%;"></div>
  
              <!-- Header -->
              <div class="flex justify-between items-start mb-8 border-b border-zinc-800/50 pb-2">
                <h2 class="text-zinc-500 text-[10px] tracking-[0.25em] uppercase flex items-center gap-2">
                  <span class="w-1.5 h-1.5 bg-zinc-500 rounded-full animate-pulse"></span>
                  >>> SYSTEM_INFO.LOG
                </h2>
                <button (click)="toggleAbout()" class="text-zinc-600 hover:text-white text-[10px] uppercase tracking-widest transition-colors">[X]</button>
              </div>
              
              <!-- Content -->
              <div class="space-y-6 text-zinc-400 text-[11px] leading-relaxed relative z-10">
                <p class="font-serif italic text-lg text-zinc-200 border-l-2 border-zinc-700/50 pl-4">
                  Ideally, a postcard is a bridge. It says 'I am here, you are there, and I am thinking of you.'
                </p>
                
                <div class="space-y-4 pt-2">
                  <p>
                    > Sometimes the distance between people feels vast â€” like planets drifting apart. This project is a quiet attempt to close that gap.
                  </p>
                  <p>
                    > It uses AI to translate a visual memory into something tangible. You provide the image; the system helps you find the words.
                  </p>
                  <p>
                    > It's a way to slow down and send a signal to someone far away: I saw this, and I thought of you.
                  </p>
                </div>
              </div>
  
              <div class="mt-8 w-full border border-zinc-800/30 hover:bg-zinc-900/20 py-3 text-center transition-colors cursor-pointer" (click)="toggleAbout()">
                 <span class="text-[9px] text-zinc-500 uppercase tracking-[0.2em]">
                   [ CLOSE_TERMINAL ]
                 </span>
              </div>
          </div>
       </div>
    </div>
  }

  <!-- Lore Overlay (Unified Terminal Style - Rose Variant) -->
  @if (showLore()) {
    <div class="fixed inset-0 z-50 bg-black flex items-center justify-center p-4 animate-fade-in font-mono" (click)="toggleLore()">
      <div class="max-w-md w-full border-2 border-rose-900/40 bg-[#0a0505] p-1 relative shadow-[0_0_50px_rgba(225,29,72,0.15)]" (click)="$event.stopPropagation()">
        
        <!-- Inner CRT Frame -->
        <div class="border border-rose-900/20 bg-rose-950/5 p-8 relative overflow-hidden">
             
            <!-- Scanlines -->
            <div class="absolute inset-0 pointer-events-none opacity-20" style="background: linear-gradient(rgba(0,0,0,0) 50%, rgba(225, 29, 72, 0.2) 50%); background-size: 100% 4px;"></div>

            <h3 class="text-rose-500 text-[10px] mb-8 tracking-[0.25em] uppercase border-b border-rose-900/40 pb-2 flex justify-between items-center">
              <span>>>> ARCHIVE_LOG_74.2</span>
              <span class="animate-pulse">_</span>
            </h3>
            
            <div class="space-y-6 text-[12px] text-rose-400/90 leading-relaxed drop-shadow-sm relative z-10">
              <p>
                > It has been 84 cycles since the evacuation. The automated uplinks are failing.
              </p>
              <p>
                > You have located an active terminal. We are transmitting the last visual memories to the Martian colonies before the grid fails completely.
              </p>
              <p>
                > The bandwidth is critically low. We cannot send high-fidelity data.
              </p>
              <p>
                > The colonies need to remember. Mars is far, but closer than they think.
              </p>
              
              <div class="flex justify-between text-[9px] uppercase tracking-widest text-rose-600/70 pt-2 border-t border-rose-900/20 mt-4">
                <span>INPUT: VISUAL DATA</span>
                <span>OUTPUT: MEMORY ARTIFACT</span>
              </div>
            </div>

            <button (click)="toggleLore()" class="mt-8 w-full border border-rose-800/30 hover:bg-rose-900/20 py-3 text-[10px] text-rose-500 uppercase tracking-widest transition-colors">
              [ RESUME_UPLINK ]
            </button>
        </div>
      </div>
    </div>
  }

  <!-- Main Content Area -->
  <main class="relative z-10 flex flex-col items-center justify-center min-h-screen w-full max-w-2xl mx-auto px-4">
    
    @switch (state()) {
      
      @case ('upload') {
        <app-camera-upload (imageSelected)="onImageSelected($event)"></app-camera-upload>
      }

      @case ('analyzing') {
        <div class="flex flex-col items-center gap-4 animate-pulse font-mono">
          <div class="w-16 h-px bg-gray-700 relative overflow-hidden">
             <!-- Use the explicit class 'animate-progress' defined in AppComponent styles -->
             <div class="absolute h-full bg-rose-500 animate-progress"></div>
          </div>
          <p class="text-rose-500 text-[10px] tracking-[0.3em] uppercase">Processing Signal...</p>
        </div>
      }

      @case ('dialogue') {
        <app-dialogue 
          [imageSrc]="originalImage()!" 
          [starterText]="currentStarter()"
          [history]="poemHistory()"
          [suggestions]="currentSuggestions()"
          [loading]="loadingNextLine()"
          [isLastLine]="poemHistory().length === 2"
          (lineCompleted)="onLineCompleted($event)"
          (finished)="finishCreation($event)"
        ></app-dialogue>
      }

      @case ('generating') {
        <div class="flex flex-col items-center gap-6 text-center px-6 animate-fade-in">
          <!-- Linear Loader -->
          <div class="w-24 h-px bg-gray-800 relative overflow-hidden">
             <div class="absolute h-full bg-rose-500 animate-progress"></div>
          </div>
          
          <div class="font-mono space-y-2">
            <h3 class="text-xs text-rose-500 tracking-widest uppercase">Transmission in Progress</h3>
            <p class="text-[10px] text-gray-400 uppercase tracking-wider min-h-[1rem]">{{ loadingMessage() }}</p>
          </div>
        </div>
      }

      @case ('result') {
        <app-postcard-result 
          [poem]="finalPoem()" 
          [stylizedImageSrc]="stylizedImage()"
          [imagePrompt]="generatedPrompt()"
          [isRegenerating]="isRegenerating()"
          [version]="promptVersion()"
          (regenerate)="onRegenerateImage($event)"
        ></app-postcard-result>
      }

    }

  </main>
</div>